import "hash"

rule malicious_pdf : PDF
{
    meta:
        author = "Taeyang Kim"
        weight = 5
        
    strings:
        $magic = { 25 50 44 46 }
        $reg0 = /Creator\\(yen vaw\\)/
        $reg1 = /Title\\(who cis\\)/
        $reg2 = /Author\\(ser pes\\)/
        $header = /%PDF-1\.(3|4|6)/
        
    condition:
        $magic at 0 and all of ($reg0, $reg1, $reg2) and $header
}

rule suspicious_version_and_creation : PDF
{
    meta:
        author = "Taeyang Kim"
        weight = 3
        
    strings:
        $magic = { 25 50 44 46 }
        $create0 = /CreationDate \\(D:20101015142358\\)/
        $create1 = /CreationDate \\(2008312053854\\)/
        $header = /%PDF-1\.(3|4|6)/
        
    condition:
        $magic at 0 and $header and (1 of ($create0, $create1))
}

rule suspicious_producer : PDF
{
    meta:
        author = "Glenn Edwards (@hiddenillusion)"
        version = "0.1"
        weight = 2
        
    strings:
        $magic = { 25 50 44 46 }
        $header = /%PDF-1\.(3|4|6)/
        $producer0 = /Producer \(Scribus PDF Library/
        $producer1 = "Notepad"
        
    condition:
        $magic in (0..1024) and $header and (1 of ($producer0, $producer1))
}

rule possible_exploit : PDF
{
    meta:
        author = "Taeyang Kim"
        weight = 3
        
    strings:
        $magic = { 25 50 44 46 }
        $attrib0 = /\/JavaScript/
        $attrib3 = /\/ASCIIHexDecode/
        $attrib4 = /\/ASCII85Decode/
        $action0 = /\/Action/
        $cond0 = "unescape"
        $nop = "9090 9090"
        
    condition:
        $magic at 0 and ((2 of ($attrib*)) or ($action0 and $cond0 and $nop))
}

rule IP : YARA
{
    meta:
        author = "Antonio S. <asanchez@plutec.net>"
        
    strings:
        $ipv4 = /([0-9]{1,3}\.){3}[0-9]{1,3}/ wide ascii
        $ipv6 = /(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ wide ascii
    
    condition:
        any of them
}

rule Big_Numbers : YARA
{
    meta:
        author = "_pusher_"
        
    strings:
        $big_number = /([0-9a-fA-F]{20}|[0-9a-fA-F]{32}|[0-9a-fA-F]{48}|[0-9a-fA-F]{64}|[0-9a-fA-F]{128}|[0-9a-fA-F]{256})/ fullword wide ascii
    
    condition:
        $big_number
}

rule FE_PCAPs : YARA
{
    meta:
        author = "@abhinavbom"
        maltype = "NA"
        version = "0.1"
        description = "Detect PCAP files uploaded to VirusTotal"
        date = "29/07/2015"
        
    strings:
        $magic = { D4 C3 B2 A1 }
        
    condition:
        $magic at 0 and filesize < 10MB
}

rule ek_submissions : YARA
{
    meta:
        author = "@abhinavbom"
        maltype = "NA"
        version = "0.1"
        description = "Detect PCAP files uploaded to VirusTotal with IDS detections for Exploit kits"
        
    strings:
        $magic = { D4 C3 B2 A1 }
        $exploit_strings = /Exploit Kit specific pattern here/
        
    condition:
        $magic at 0 and $exploit_strings
}
